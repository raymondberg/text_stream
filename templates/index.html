{% extends "base.html" %}

{% block content %}

<div id="messages" class="row">

</div>

{% endblock %}

{% block custom_js %}
<script>
  socket.on('connect', function() {
    socket.emit('resend_all');
  });

  var messageStack = {};

  socket.on('message', function(message) {
    console.log("received" + message.id)
    if(messageStack[message.id] || isMessageDisplayed(message.id)) {
      console.log("dropping " + message.id)
    } else {
      messageStack[message.id] = message.content
    }
  });

  function displayTick() {
    var messageId = randomProperty(messageStack)

    if (messageId) {
      if (isMessageDisplayed(messageId)) {
        console.log("tried to render, but caught duplicate" + messageId)
      } else {
        $("<div>", {id: "message_" + messageId, "class": "message col-lg-2 col-md-3 col-sm-6"}).text(messageStack[messageId]).prependTo($("#messages"))
      }
      delete messageStack[messageId]
    }
  }

  setInterval(displayTick, 1000)
</script>
{% endblock %}
